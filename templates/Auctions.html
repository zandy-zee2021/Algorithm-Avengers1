<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ShopPage.css') }}"> <!-- Link to external CSS -->
    <script src="{{ url_for('static', filename='js/websitescript.js') }}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>Auctions Page</title>
</head>
<body>
<div class="navbar">
    <div class="logo">
        <img src="{{ url_for('static', filename='Images/WhatsApp Image 2024-07-29 at 19.44.56.jpeg') }}" alt="logo" class="logo-img">
        <h1 class="website-name">AGRIMARKET</h1>
    </div>
    <div class="nav-links">
        <a href="{{ url_for('home') }}" class="active">HOME</a>
        <a href="{{ url_for('about') }}">ABOUT</a>
        <a href="{{ url_for('auctions') }}">AUCTIONS</a>
        <a href="{{ url_for('contact') }}">CONTACT<SPAN class="fa-light fa-phone"></SPAN></a>
        <a href="{{ url_for('addToCart') }}">SHOP<span class="cart-icon">ðŸ›’</span></a>
    </div>
</div>

<div class="search-container">
    <input type="text" class="search-bar" placeholder="Search products..."> <span></span><i class="fa-regular fa-upload"></i>
    <button class="search-button">Send</button>
    <input type="text" id="imageURL" placeholder="Enter image URL here">
    <button class="upload-button" onclick="handleUpload()">Upload</button>


</div>
<!-- Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p id="modalMessage"></p>
    </div>
</div>


<div class="image-gallery">
<!--    <div class="gallery-arrow left" onclick="prevSlide()"></div>-->
    <div class="gallery-item">
        <img src="{{ url_for('static', filename='Images/images.jpeg') }}" alt="Image 1" class="gallery-img">
        <div class="gallery-caption">
            <span class="caption-text">Auction starting in: </span>
            <span class="timer" id="timer1"></span>
    </div>
    </div>
    <div class="gallery-item">
        <img src="{{ url_for('static', filename='Images/image.png') }}" alt="Image 2" class="gallery-img">
        <div class="gallery-caption">
            <span class="caption-text">Auction starting in: </span>
            <span class="timer" id="timer2"></span>
        </div>
    </div>
    <div class="gallery-item">
        <img src="{{ url_for('static', filename='Images/image1.png') }}" alt="Image 3" class="gallery-img">
        <div class="gallery-caption">
            <span class="caption-text">Auction starting in: </span>
            <span class="timer" id="timer3"></span>
        </div>
    </div>
    <div class="gallery-item">
        <img src="{{ url_for('static', filename='Images/images-1.jpeg') }}" alt="Image 4" class="gallery-img">
        <div class="gallery-caption">
            <span class="caption-text">Auction starting in: </span>
            <span class="timer" id="timer4"></span>
        </div>
    </div>
    <script>
        async function handleUpload() {
    const uploadButton = document.querySelector('.upload-button');
    const imageUrlInput = document.getElementById('imageURL');
    const imageUrl = imageUrlInput.value.trim();

    if (!imageUrl) {
        alert('Please provide an image URL.');
        return;
    }

    uploadButton.textContent = 'Processing...';
    uploadButton.disabled = true;

    try {
        const response = await fetch('https://f6af-41-116-106-123.ngrok-free.app/api/auction-analysis/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                image: imageUrl,
                prompt: "Evaluate the health and suitability of the livestock for auction based on this image of medical record of the particular livestock. please respond with eligible or not eligible only do not explain"
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log('Response:', result.response);

        // Check the response and set the modal message accordingly
        let modalMessage = '';
        if (result.response.toLowerCase() === 'eligible') {
            modalMessage = 'The livestock is eligible for auction.';
        } else if (result.response.toLowerCase() === 'not eligible') {
            modalMessage = 'The livestock is not eligible for auction.';
        } else {
            modalMessage = `Response: ${result.response}`;
        }

        // Display the result in a modal
        document.getElementById('modalMessage').textContent = modalMessage;
        document.getElementById('myModal').style.display = "block";

        uploadButton.textContent = 'Success!';
    } catch (error) {
        console.error('There was an error!', error);
        uploadButton.textContent = 'Upload Failed';
    } finally {
        setTimeout(() => {
            uploadButton.textContent = 'Upload';
            uploadButton.disabled = false;
        }, 2000);
    }
}

// Close the modal when the user clicks the "x"
document.querySelector('.close').onclick = function() {
    document.getElementById('myModal').style.display = "none";
}

// Close the modal when the user clicks anywhere outside of it
window.onclick = function(event) {
    if (event.target == document.getElementById('myModal')) {
        document.getElementById('myModal').style.display = "none";
    }
}



            function startAuctionTimer(duration, display) {
                let timer = duration, hours, minutes, seconds;
                setInterval(function () {
                    hours = parseInt(timer / 3600, 10);
                    minutes = parseInt((timer % 3600) / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    hours = hours < 10 ? "0" + hours : hours;
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    display.textContent = hours + ":" + minutes + ":" + seconds;

                    if (--timer < 0) {
                        timer = duration;
                    }
                }, 1000);
            }

            window.onload = function () {
                const duration = 5 * 60 * 60; // Timer duration in seconds (5 hours)
                const timer1 = document.querySelector('#timer1');
                const timer2 = document.querySelector('#timer2');
                const timer3 = document.querySelector('#timer3');
                const timer4 = document.querySelector('#timer4');

                startAuctionTimer(duration, timer1);
                startAuctionTimer(duration, timer2);
                startAuctionTimer(duration, timer3);
                startAuctionTimer(duration, timer4);
            };
    </script>
</div>>

</body>
</html>